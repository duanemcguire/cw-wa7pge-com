{% extends 'base.html' %}
    
{% block content %}
    
<style>
    button {margin-bottom: 4px;}
    @media (max-width: 768px) {
        #hotkeys {
            display: none;
        }
    }
</style>
<body>
    <h2>Phrase Copy Practice</h2>
    

    <form method="GET" id='theForm'>
        WPM: 
        <select name="wpm" id="wpm" style="width: 95px;" >
            {% for wpmo in wpm_options %}
                <option value="{{ wpmo }}" {% if wpmo|int  == wpm|int  %}selected{% endif %}>{{ wpmo }}</option>
            {% endfor %}
        </select>

        Category: <select name="category" id='category' style="max-width: 200px;">
            {% for category in categories %}
            <option value="{{ category }}" {% if category==selected_category %}selected{% endif %}>{{ category }}</option>
            {% endfor %}
        </select>        

        Collection: <select id="selectCollection" name="filename" style="width: 200px;">
            {% for file in files %}
                <option value="{{ file }}" {% if file == selected_file %}selected{% endif %}>{{ file }}</option>
            {% endfor %}
        </select>
	
        
        <input type="hidden" name="newCategory" id="newCategory" value = "0">

    </form>

    
    <button id="buttonGetPhrase"><span style="text-decoration:underline">G</span>et a {{selected_category}}</button><BR>    
    <button id="buttonPlayCW"  style="visibility: hidden;"><span style="text-decoration:underline">P</span>lay the CW</button>
    <button id="buttonDisplayTitle" style="visibility: hidden;"><span style="text-decoration:underline">R</span>eveal the {{selected_category}}</button>
    <button id="buttonHideTitle" style="visibility: hidden;"><span style="text-decoration:underline">H</span>ide the {{selected_category}}</button>
    <div class="line-display" id="reveal_title" style="display:none;"></div>    

    <div id="hotkeys">
        <BR>
        Hot Keys:
        <ul>
            <li>Right Arrow: Get the next phrase</li>
            <li>Left Arrow: Play the CW again</li>
            <li>Up Arrow: Reveal the phrase</li>
            <li>Down Arrow: Hide the phrase</li>
            <li>Space: Pause</li>
        </ul>
    </div>
    

 <script>
    let lines = {{lines | safe}};
    let prefix = 'VVV  '
    let line = ''
    const player = new jscw();
    player.init()



    function play_cw(text){
        player.stop()
        player.init()
        wpmEl = document.getElementById('wpm')
        speed = wpmEl.options[wpmEl.selectedIndex].value
        player.setWpm(speed);
        player.setFreq(600);
        player.setStartDelay(1);
        player.play(prefix + text);
        prefix = ""
    }
    function display_title(){
        document.getElementById("reveal_title").innerText = song_title;
        document.getElementById("reveal_title").style.display = "block";
    }
    function getLine(){
        randomIndex = Math.floor(Math.random() * lines.length);
        line = lines[randomIndex].trim().replace("~"," ")
        line = line.replace("("," = ")
        line = line.replace(")"," = ") 
        return line;
    }
    function getNext(){
        if (lines.length > 0){
            line = getLine()
            play_cw(line);
            document.getElementById('reveal_title').innerText = line;
            buttonPlayCW.style.visibility = 'visible';
            buttonDisplayTitle.style.visibility = 'visible';
            buttonHideTitle.style.visibility = 'hidden';
            document.getElementById('reveal_title').style.display = 'none';
        }else{
            //Submit the form to collect the lines
            theForm.submit();
        }


    }

    category = document.getElementById('category');
    category.addEventListener('change', () => {
        newCategory = document.getElementById('newCategory');
        newCategory.value = 1;        
        theForm.submit();
    });
    selectCollection.addEventListener('change', () => {
        theForm.submit();
    });
    buttonPlayCW.addEventListener('click', () =>{
        play_cw(line)

    });

    buttonDisplayTitle.addEventListener('click', () => {
        document.getElementById('reveal_title').style.display = 'block';
        buttonHideTitle.style.visibility = 'visible';

    });
    buttonHideTitle.addEventListener('click', () => {
        document.getElementById('reveal_title').style.display = 'none';
        buttonHideTitle.style.visibility = 'hidden';
        
    });

    buttonGetPhrase.addEventListener('click', () => {
        getNext()
    });
// Hot Keys

    window.addEventListener("keydown", function(e) {
        if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
            e.preventDefault();
        }
    }, false);
    document.addEventListener('keydown', function(event) {
        // Check for specific key
        if (event.key === 'g' || event.key === "ArrowRight" ) {
            // Get Next Phrase
            getNext();
        }
        if (event.key === 'p'  || event.key === "ArrowLeft") {
            // Play the CW
            play_cw(line);
        }
        if (event.key === 'r' || event.key === "ArrowUp") {
            // Reveal Phrase
            document.getElementById('reveal_title').style.display = 'block';
            buttonHideTitle.style.visibility = 'visible';
        }
        if (event.key === 'h' || event.key === "ArrowDown") {
            // Hide Phrase
            document.getElementById('reveal_title').style.display = 'none';
            buttonHideTitle.style.visibility = 'hidden';
        }
        if (event.key === ' ' ) {
            // pause
            player.pause()
        }


    });


</SCRIPT>    
{% endblock %}    