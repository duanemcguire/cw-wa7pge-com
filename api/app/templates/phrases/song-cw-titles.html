{% extends 'base.html' %}
    
{% block content %}
    
 <script>
        {% if line %}
            let song_title =  decodeHTMLEntities("{{ line }}")
            // play_cw(song_title)
        {% endif %}
        let prefix = 'VVV  '
        function decodeHTMLEntities(text) {
            const tempElement = document.createElement('textarea');
            tempElement.innerHTML = text;
            return tempElement.value;
        }
        function play_cw(){
            const player = new jscw();
            wpmEl = document.getElementById('wpm')
            speed = wpmEl.options[wpmEl.selectedIndex].value
            player.setWpm(speed);
            player.setFreq(600);
            player.setStartDelay(1);
            player.play(prefix + song_title);
            prefix = ""
        }
        function display_title(){
            document.getElementById("reveal_title").innerText = song_title;
            document.getElementById("reveal_title").style.display = "block";
        }
</script>
<body>
    <h1>CW Copy Practice<BR>A song title from the ages</h1>
    <form method="POST">
        WPM: 
        <select name="wpm" id="wpm" style="width: 95px;" >
            {% for wpmo in wpm_options %}
                <option value="{{ wpmo }}" {% if wpmo|int  == wpm|int  %}selected{% endif %}>{{ wpmo }}</option>
            {% endfor %}
        </select><BR>

        Collection: <select name="filename" style="width: 200px;">
            {% for file in files %}
                <option value="{{ file }}" {% if file == selected_file %}selected{% endif %}>{{ file }}</option>
            {% endfor %}
        </select>
	<br>
        <button type="submit">Get a Song Title</button>
    </form>

    {% if line %}
        <div class="line-display">
            <button onclick="play_cw()">Play the CW</button>
            <button onclick="display_title()">Reveal the song title</button>
            <div id="reveal_title" style="display:none;"></div>    
        </div>
    {% endif %}
{% endblock %}    