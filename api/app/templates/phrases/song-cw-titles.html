{% extends 'editorial-base.html' %}
    
{% block content %}
    
 <script>
        {% if line %}
            let song_title =  decodeHTMLEntities("{{ line }}")
            // play_cw(song_title)
        {% endif %}
        let prefix = 'VVV  '
        function decodeHTMLEntities(text) {
            const tempElement = document.createElement('textarea');
            tempElement.innerHTML = text;
            return tempElement.value;
        }
        function play_cw(){
            const player = new jscw();
            wpmEl = document.getElementById('wpm')
            speed = wpmEl.options[wpmEl.selectedIndex].value
            player.setWpm(speed);
            player.setFreq(600);
            player.setStartDelay(1);
            player.play(prefix + song_title);
            prefix = ""
        }
        function display_title(){
            document.getElementById("reveal_title").innerText = song_title;
            document.getElementById("reveal_title").style.display = "block";
        }
</script>
<body>
    <h2>Phrase Copy Practice</h2>
    

    <form method="POST" id='theForm'>
        WPM: 
        <select name="wpm" id="wpm" style="width: 95px;" >
            {% for wpmo in wpm_options %}
                <option value="{{ wpmo }}" {% if wpmo|int  == wpm|int  %}selected{% endif %}>{{ wpmo }}</option>
            {% endfor %}
        </select><BR>

        Category: <select name="category" id='category' style="max-width: 200px;">
            {% for category in categories %}
            <option value="{{ category }}" {% if category==selected_category %}selected{% endif %}>{{ category }}</option>
            {% endfor %}
        </select>        

        Collection: <select name="filename" style="width: 200px;">
            {% for file in files %}
                <option value="{{ file }}" {% if file == selected_file %}selected{% endif %}>{{ file }}</option>
            {% endfor %}
        </select>
	<br>
        <button type="submit">Get a {{selected_category}}</button>
        <input type="hidden" name="newCategory" id="newCategory" value = "0">

    </form>

    {% if line %}
        
            <button onclick="play_cw()">Play the CW</button>
            <button onclick="display_title()">Reveal the {{selected_category}}</button>
            <div class="line-display" id="reveal_title" style="display:none;"></div>    
    {% endif %}

<SCRIPT>
    category = document.getElementById('category');
    category.addEventListener('change', () => {
        newCategory = document.getElementById('newCategory');
        newCategory.value = 1;        
        const form = document.getElementById('theForm')
        form.submit();
    });
</SCRIPT>    
{% endblock %}    